{% extends "base.html" %}
{% load portal_extras %}
{% block content %}
<div class="page-header">
    <h2 class="mb-0">My Expense Claims</h2>
    <div class="actions">
        <a class="btn btn-outline-secondary btn-sm" href="{% url 'dashboard' %}">Home</a>
        {% if module_perms.finance %}
            <a class="btn btn-outline-secondary btn-sm" href="{% url 'expense_claim_admin' %}">All claims</a>
        {% endif %}
        <a class="btn btn-primary btn-sm" data-bs-toggle="offcanvas" href="#claimOffcanvas" role="button" aria-controls="claimOffcanvas">New claim</a>
    </div>
</div>

<div class="d-md-flex gap-3 align-items-start">
    <div class="flex-grow-1">
        <div class="txn-cards">
            {% for claim in claims %}
            <article class="txn-card">
                <div class="txn-card__header">
                    <div>
                        <div class="eyebrow text-uppercase">Date</div>
                        <div class="txn-date">{{ claim.expense_date|date:"d MMM YYYY" }}</div>
                    </div>
                    <div class="text-end">
                        <div class="eyebrow text-uppercase">Amount</div>
                        <div class="txn-amount">{{ claim.amount|rupee }}</div>
                    </div>
                </div>
                <div class="txn-card__body">
                    <div class="txn-title">{{ claim.category|default:"Expense" }}</div>
                    <div class="txn-meta">
                        {% if claim.project %}<span class="chip chip-soft">Project · {{ claim.project.code }}</span>{% endif %}
                        {% if claim.description %}<span class="chip chip-ghost">{{ claim.description }}</span>{% endif %}
                        <span class="chip chip-soft bg-light text-dark border">Status · {{ claim.get_status_display }}</span>
                    </div>
                </div>
            </article>
            {% empty %}
                {% include "includes/empty_state.html" with colspan=5 title="No claims yet" description="Submit expense claims for reimbursement." cta_label="New Claim" cta_class="btn btn-sm btn-primary" cta_attrs='data-bs-toggle="offcanvas" href="#claimOffcanvas"' compact=True %}
            {% endfor %}
        </div>
    </div>

    <div class="offcanvas-md offcanvas-end offcanvas-glow" tabindex="-1" id="claimOffcanvas" aria-labelledby="claimOffcanvasLabel" data-bs-scroll="true" style="--bs-offcanvas-width: 420px;">
        <div class="offcanvas-header">
            <h5 class="offcanvas-title" id="claimOffcanvasLabel">New expense claim</h5>
            <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {% for field in form %}
                    <div class="mb-3">
                        <label class="form-label" for="{{ field.id_for_label }}">{{ field.label }}</label>
                        {{ field|add_class:"form-control" }}
                        {% for error in field.errors %}<div class="text-danger small">{{ error }}</div>{% endfor %}
                        {% if field.help_text %}<div class="form-text">{{ field.help_text }}</div>{% endif %}
                    </div>
                {% endfor %}
                <button class="btn btn-primary w-100">Submit</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}
